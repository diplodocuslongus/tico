:
P2=$(sort -gk2 < shape | tail -n1 | awk '{print $1-4000}'); P3=$(sort -gk3 < shape | tail -n1 | awk '{print $1-4000}'); eval `cat shape | awk '{print $1,$2/(1+($1>4150)*(($1-4000)/150)^2)/(1+($1<3900)*((-$1+3900)/100)^2),$3/(1+($1>4150)*(($1-4000)/150)^2)/(1+($1<3900)*((-$1+3900)/100)^2)}'  | stat.sh | awk '{printf "m1=%g;m2=%g;s1=%g;s2=%g;\n",$6,$10,$7,$11}'`; cat shape | awk '{print $1,(($2/(1+($1>4150)*(($1-4000)/150)^2)/(1+($1<3900)*((-$1+3900)/100)^2))-('$m1')),(($3/(1+($1>4150)*(($1-4000)/150)^2)/(1+($1<3900)*((-$1+3900)/100)^2)-('$m2')))}'  | awk '{a2[(NR-('$P2')+7999)%8000]=$2; a3[(NR-('$P3')+7999)%8000]=$3}END{for(i=0;i<8000;i++){print i,a2[i],a3[i]}}' | tee pulseshape | plot 'u 1:2 , "" u 1:3 , "shape" u 1:2 w l , "" u 1:3 w l ; set xrange [3950:4100]; '
